var t={};class e{static gameStatus(){return{idle:"idle",playing:"playing",win:"win",lose:"lose"}}static getInitialState(){return[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]}constructor(t=e.getInitialState()){this.gameStatus=e.gameStatus().idle,this.score=0,this.initialState=JSON.parse(JSON.stringify(t)),this.state=t}getEmptyTiles(){let t=[];for(let e=0;e<4;e++)for(let s=0;s<4;s++)0===this.state[e][s]&&t.push([e,s]);return t}generateTile(t=1){let e=this.getEmptyTiles(),s=Math.min(t,e.length);if(e.length){for(let t=0;t<s;t++){let t=Math.floor(Math.random()*e.length),[s,a]=e.splice(t,1)[0];this.state[s][a]=Math.random()>=.9?4:2}this.updateBoard()}}updateBoard(){document.querySelectorAll(".field-row").forEach((t,e)=>{t.querySelectorAll(".field-cell").forEach((t,s)=>{let a=this.state[e][s];t.classList="field-cell",t.innerHTML="",0!==a&&(t.classList.add(`field-cell--${a}`),t.innerHTML=a)})}),this.isWin(),this.isLose()}isWin(){this.state.flat().some(t=>2048===t&&(this.gameStatus=e.gameStatus().win,!0))}isLose(){if(!(this.getEmptyTiles().length>0)){for(let t=0;t<4;t++)for(let e=0;e<4;e++)if(t<3&&this.state[t][e]===this.state[t+1][e]||e<3&&this.state[t][e]===this.state[t][e+1])return;this.gameStatus=e.gameStatus().lose}}updateState(t){JSON.stringify(t)!==JSON.stringify(this.getState())&&(this.state=t,this.updateBoard(),this.generateTile())}moveLeft(){if(this.getStatus()!==e.gameStatus().playing)return;let t=this.getState().map(t=>this.compareAndMerge(t));this.updateState(t)}moveRight(){if(this.getStatus()!==e.gameStatus().playing)return;let t=this.getState().map(t=>this.compareAndMerge([...t].reverse())).map(t=>t.reverse());this.updateState(t)}moveUp(){if(this.getStatus()!==e.gameStatus().playing)return;let t=e.getInitialState();for(let e=0;e<4;e++){let s=[this.state[0][e],this.state[1][e],this.state[2][e],this.state[3][e]];s=this.compareAndMerge(s);for(let a=0;a<4;a++)t[a][e]=s[a]}this.updateState(t)}moveDown(){if(this.getStatus()!==e.gameStatus().playing)return;let t=e.getInitialState();for(let e=0;e<4;e++){let s=[this.state[0][e],this.state[1][e],this.state[2][e],this.state[3][e]];(s=this.compareAndMerge(s.reverse())).reverse();for(let a=0;a<4;a++)t[a][e]=s[a]}this.updateState(t)}getScore(){return this.score}getState(){return this.state}getStatus(){return this.gameStatus}start(){this.score=0,this.state=e.getInitialState(),this.gameStatus=e.gameStatus().playing,this.updateBoard(),this.generateTile(2)}restart(){this.score=0,this.state=e.getInitialState(),this.gameStatus=e.gameStatus().playing,this.updateBoard(),this.generateTile(2)}filterZero(t){return t.filter(t=>0!==t)}compareAndMerge(t){let e=this.filterZero(t);for(let t=0;t<e.length;t++)e[t]===e[t+1]&&(e[t]+=e[t+1],e[t+1]=0,this.score+=e[t]);for(e=this.filterZero(e);e.length<4;)e.push(0);return e}}const s=new(t=e),a=document.querySelector(".button"),i=document.querySelector(".game-score"),r=document.querySelector(".message-start"),l=document.querySelector(".message-lose"),n={idle:r,win:document.querySelector(".message-win"),lose:l};function o(){let t=s.getStatus();for(let e in n)n[e]&&n[e].classList.toggle("hidden",e!==t)}a.addEventListener("click",()=>{a.classList.contains("start")?(s.start(),a.classList.replace("start","restart"),a.innerHTML="Restart"):s.restart(),i.innerHTML=s.getScore(),o()}),document.addEventListener("keyup",e=>{if(s.getStatus()===t.gameStatus().playing){switch(e.code){case"ArrowLeft":s.moveLeft();break;case"ArrowRight":s.moveRight();break;case"ArrowUp":s.moveUp();break;case"ArrowDown":s.moveDown()}i.innerHTML=s.getScore(),o()}});
//# sourceMappingURL=index.474732d2.js.map
